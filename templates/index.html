<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MusicStream - 在线音乐平台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/index.css">
</head>
<body>
    <!-- 顶部导航 -->
    <nav class="top-nav">
        <div class="logo">
            <i class="fas fa-music"></i>
            MusicStream
        </div>

        <!-- 找到 search.html 中的搜索容器部分，修改 form 的 action 属性 -->
<div class="search-container">
    <!-- 关键修复：用 {% url 'search' page=1 %} 生成正确路由，确保提交到搜索视图的第1页 -->
    <form id="search-form" action="{% url 'search' page=1 %}" method="get">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="search-input" name="keyword"
               placeholder="搜索歌曲、艺术家或专辑..."
               value="{{ keyword|default:'' }}">  <!-- 保留关键词回显，提升体验 -->
    </form>
</div>

        <!-- 顶部导航 - 用户菜单单（替换原有代码） -->
<div class="user-menu">
    {% if request.user.is_authenticated %}
    <!-- 已登录：跳转用户中心（默认第1页） -->
    <a href="{% url 'home' page=1 %}" title="个人中心">
        <div class="user-avatar">
            {% if user_avatar %}
            <img src="{{ user_avatar }}" alt="用户头像" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">
            {% else %}
            <i class="fas fa-user"></i>
            {% endif %}
        </div>
    </a>
    {% else %}
    <!-- 未登录：跳转登录页 -->
    <a href="{% url 'login' %}" title="登录">
        <div class="user-avatar">
            <i class="fas fa-user"></i>
        </div>
    </a>
    {% endif %}
</div>

    </nav>

    <div class="main-layout">
        <!-- 侧边栏 -->
        <aside class="sidebar">
            <div class="nav-section">
                <div class="nav-title">发现</div>
                <a href="#" class="nav-item active">
                    <i class="fas fa-home"></i>
                    首页
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-compass"></i>
                    浏览
                </a>
                <a href="{% url 'ranking' %}" class="nav-item">
                    <i class="fas fa-chart-line"></i>
                    排行榜
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-title">我的音乐</div>
                <a href="collect.html" class="nav-item">
                    <i class="fas fa-heart"></i>
                    我喜欢的
                </a>
                <a href="recentPlay.html" class="nav-item">
                    <i class="fas fa-clock"></i>
                    最近播放
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-download"></i>
                    已下载
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-title">播放列表</div>
                <a href="#" class="nav-item">
                    <i class="fas fa-plus"></i>
                    创建播放列表
                </a>
            </div>
        </aside>

        <!-- 主内容 -->

<main class="main-content">
    <!-- 欢迎区域 -->
    <section class="welcome-section">
        <h1 class="welcome-title">发现好音乐</h1>
        <p class="welcome-subtitle">数百万首歌曲，个性化推荐，随时随地享受音乐</p>
        <button class="cta-button">开始探索</button>
    </section>

    <!-- 热搜歌曲 -->
    <section class="content-section">
        <div class="section-header">
            <h2 class="section-title">热搜歌曲</h2>
            <a href="#" class="view-all">查看全部</a>
        </div>

        <div class="music-grid" style="grid-template-columns: repeat(3, 1fr);">
            {% for song_dynamic in searchs %}
            <div class="music-card"
                data-song-url="{{ song_dynamic.song.file.url }}"
                data-song-title="{{ song_dynamic.song.name }}"
                data-song-artist="{{ song_dynamic.song.singer }}"
                data-song-id="{{ song_dynamic.song.id }}">
                <div class="album-cover">
                    {% if song_dynamic.song.img %}
                    <img src="{{ song_dynamic.song.img.url }}" alt="{{ song_dynamic.song.name }}">
                    {% else %}
                    <i class="fas fa-compact-disc" style="font-size: 3rem;"></i>
                    {% endif %}
                    <div class="play-overlay">
                        <button class="play-button">
                            <i class="fas fa-play"></i>
                        </button>
                    </div>
                </div>
                <div class="song-title">{{ song_dynamic.song.name }}</div>
                <div class="artist-name">{{ song_dynamic.song.singer }}</div>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- 推荐音乐 -->
    <section class="content-section">
        <div class="section-header">
            <h2 class="section-title">为你推荐</h2>
            <a href="#" class="view-all">查看全部</a>
        </div>

        <div class="music-grid">
            {% for song in recommend %}
            <div class="music-card"
                data-song-url="{{ song.file.url }}"
                data-song-title="{{ song.name }}"
                data-song-artist="{{ song.singer }}"
                data-song-id="{{ song.id }}">
                <div class="album-cover">
                    {% if song.img %}
                    <img src="{{ song.img.url }}" alt="{{ song.name }}" style="width:100%; height:100%; object-fit:cover;">
                    {% else %}
                    <i class="fas fa-music"></i>
                    {% endif %}
                    <div class="play-overlay">
                        <button class="play-button">
                            <i class="fas fa-play"></i>
                        </button>
                    </div>
                </div>
                <div class="song-title">{{ song.name }}</div>
                <div class="artist-name">{{ song.singer }}</div>
            </div>
            {% endfor %}
        </div>
    </section>
</main>

    </div>

    <!-- 底部播放器 -->
    <div class="bottom-player">
        <div class="current-track" onclick="goToCurrentPlayPage()">
            <div class="track-cover">
                <i class="fas fa-music"></i>
            </div>
            <div class="track-info">
                <h4>选择一首歌曲</h4>
                <p>艺术家</p>
            </div>
        </div>

        <div class="player-controls">
            <button class="control-button" onclick="previousSong">
                <i class="fas fa-step-backward"></i>
            </button>
            <button class="control-button play-pause-btn" onclick="togglePlayPause()">
                <i class="fas fa-play"></i>
            </button>
            <button class="control-button">
                <i class="fas fa-step-forward"></i>
            </button>
        </div>
        <div class="progress-container">
            <span class="current-time">0:00</span>
            <div class="progress-slider" onclick="seekTo(event)">
                <div class="progress-fill"></div>
            </div>
            <span class="duration">0:00</span>
        </div>

        <div class="volume-control">
            <i class="fas fa-volume-up" onclick="toggleMute()"></i>
            <div class="volume-slider" onclick="setVolume(event)">
                <div class="volume-fill"></div>
            </div>
        </div>
        <audio id="audio-player" preload="metadata"></audio>
    </div>
    <script src="/static/js/index.js"></script>

</body>
</html>
